# Supabase 데이터베이스 설정 가이드

## 실행 순서

### 1단계: 테이블 생성 (schema.sql)

Supabase 대시보드 → **SQL Editor** → `schema.sql` 내용 전체 붙여넣기 → **Run**

생성되는 테이블:
- `categories` — 카테고리 + 초기 데이터 5개 포함
- `profiles` — 사용자 프로필
- `free_readings` — 무료 맛보기 콘텐츠
- `orders` — 건당 결제 주문
- `subscriptions` — 1년 무제한 구독
- `generated_readings` — AI 생성 결과 캐시
- `reviews` — 리뷰

### 2단계: 시드 데이터 (seeds.sql)

schema.sql 실행 완료 후 → `seeds.sql` 내용 전체 붙여넣기 → **Run**

삽입되는 시드 데이터:
| 카테고리 | 천간 | 지지 | 성별 |
|---------|------|------|------|
| 올해 종합 운세 | 갑 | 자 | 남 (1984년생) |
| 올해 종합 운세 | 갑 | 자 | 여 (1984년생) |
| 올해 종합 운세 | 경 | 오 | 남 (1990년생) |
| 올해 종합 운세 | 임 | 신 | 여 (1992년생) |
| 올해 종합 운세 | 무 | 진 | 남 (1988년생) |
| 도화살 알아보기 | 병 | 인 | 여 (1986년생) |
| 도화살 알아보기 | 기 | 사 | 남 (1989년생) |
| 재회 가능성 | 신 | 미 | 여 (1991년생) |
| 재회 가능성 | 계 | 유 | 남 (1993년생) |
| 궁합 분석 | 을 | 해 | 여 (1995년생) |
| 궁합 분석 | 정 | 축 | 남 (1997년생) |

### 주요 연도별 천간/지지 참고

| 연도 | 천간 | 지지 | 연도 | 천간 | 지지 |
|------|------|------|------|------|------|
| 1984 | 갑 | 자 | 1995 | 을 | 해 |
| 1985 | 을 | 축 | 1996 | 병 | 자 |
| 1986 | 병 | 인 | 1997 | 정 | 축 |
| 1987 | 정 | 묘 | 1998 | 무 | 인 |
| 1988 | 무 | 진 | 1999 | 기 | 묘 |
| 1989 | 기 | 사 | 2000 | 경 | 진 |
| 1990 | 경 | 오 | 2001 | 신 | 사 |
| 1991 | 신 | 미 | 2002 | 임 | 오 |
| 1992 | 임 | 신 | 2003 | 계 | 미 |
| 1993 | 계 | 유 | 2004 | 갑 | 신 |
| 1994 | 갑 | 술 | 2005 | 을 | 유 |

> **주의**: 연주(年柱)는 입춘(2월 4~5일 경) 기준입니다.
> 1~2월 초 출생자는 전년도 천간/지지를 사용합니다.
> 코드의 `lunar-javascript` 라이브러리가 이를 자동으로 처리합니다.

## 환경 변수 확인

`.env.local`에 다음이 설정되어 있어야 합니다:

```
NEXT_PUBLIC_SUPABASE_URL=https://[프로젝트ID].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[anon key]
SUPABASE_SERVICE_ROLE_KEY=[service role key]
```

## free_readings 콘텐츠 구조

```json
{
  "summary": "전체 요약 문단 (무료 공개)",
  "sections": [
    { "title": "섹션 1 제목", "body": "내용..." },  ← 무료 공개
    { "title": "섹션 2 제목", "body": "내용..." },  ← 무료 공개
    { "title": "섹션 3 제목", "body": "내용..." },  ← 블러 처리 (프리미엄)
    { "title": "섹션 4 제목", "body": "내용..." },  ← 블러 처리 (프리미엄)
    { "title": "섹션 5 제목", "body": "내용..." }   ← 블러 처리 (프리미엄)
  ]
}
```

앞 2개 섹션은 무료로 공개되고, 3번째부터는 블러 처리되어 AI 프리미엄 구매를 유도합니다.
